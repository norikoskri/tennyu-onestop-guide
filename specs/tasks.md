# 実装タスク

**プロジェクト名**: 地域ガイド（転入者向け地域情報プラットフォーム）
**作成日**: 2026-01-19

---

## 📋 タスク概要

### 全体の進め方

```
Phase 1: 環境セットアップ
    ↓
Phase 2: データ・型定義
    ↓
Phase 3: AIチャット基盤
    ↓
Phase 4: コア機能実装
    ↓
Phase 5: UI/UX改善
    ↓
Phase 6: テスト・デプロイ
```

### Phase別の目的

| Phase | 目的 | 主な成果物 |
|-------|------|-----------|
| 1 | 開発環境の準備 | Next.jsプロジェクト、ディレクトリ構成 |
| 2 | データ基盤の整備 | 型定義、モックデータ、Context |
| 3 | AI会話機能の実装 | チャットUI、AIレスポンス |
| 4 | コア機能の実装 | ダッシュボード、タスク管理、地域ガイド |
| 5 | 品質向上 | レスポンシブ対応、UX改善 |
| 6 | 公開準備 | 動作確認、Vercelデプロイ |

---

## Phase 1: 環境セットアップ

### 1.1 プロジェクト初期化

**タスク**: Next.jsプロジェクトを作成

```bash
npx create-next-app@latest . --typescript --tailwind --eslint --app --src-dir
```

**選択肢**:
- TypeScript: Yes
- ESLint: Yes
- Tailwind CSS: Yes
- `src/` directory: Yes
- App Router: Yes
- Import alias: @/*

**完了条件**:
- [ ] プロジェクトが生成される
- [ ] `npm run dev` でローカルサーバーが起動する
- [ ] http://localhost:3000 でページが表示される

---

### 1.2 追加パッケージのインストール

**タスク**: 必要なパッケージをインストール

```bash
npm install ai openai
npm install @heroicons/react
npm install clsx
```

| パッケージ | 用途 |
|-----------|------|
| `ai` | Vercel AI SDK（チャット機能） |
| `openai` | OpenAI API クライアント |
| `@heroicons/react` | アイコン |
| `clsx` | className の条件分岐 |

**完了条件**:
- [ ] パッケージがインストールされる
- [ ] `package.json` に依存関係が追加される

---

### 1.3 ディレクトリ構成の作成

**タスク**: 設計書に基づいてディレクトリを作成

```bash
mkdir -p src/components/{chat,dashboard,guide,tasks,ui}
mkdir -p src/contexts
mkdir -p src/hooks
mkdir -p src/lib/{ai,tasks,utils}
mkdir -p src/data/regions
mkdir -p src/types
```

**参照**: @specs/design.md のディレクトリ構成

**完了条件**:
- [ ] すべてのディレクトリが作成される

---

### 1.4 環境変数の設定

**タスク**: `.env.local` を作成

```bash
# .env.local
OPENAI_API_KEY=your-api-key-here
```

**注意**:
- `.env.local` は `.gitignore` に含まれていることを確認
- モック版ではAPIキーなしでも動作するよう実装する

**完了条件**:
- [ ] `.env.local` が作成される
- [ ] `.gitignore` に `.env.local` が含まれている

---

### 1.5 Git初期化・初回コミット

**タスク**: Gitリポジトリを初期化し、初回コミット

```bash
git init
git add .
git commit -m "feat: プロジェクト初期化"
```

**完了条件**:
- [ ] Gitリポジトリが初期化される
- [ ] 初回コミットが作成される

---

## Phase 2: データ・型定義

### 2.1 型定義の作成

**タスク**: `src/types/` 配下に型定義ファイルを作成

**参照**: @specs/design.md のデータモデル

#### 2.1.1 `src/types/user.ts`

```typescript
// UserProfile, Address, FamilyType, FamilyMember, Interest
```

#### 2.1.2 `src/types/task.ts`

```typescript
// ProcedureTask, TaskCategory, AutomationLevel, TaskStatus, OfficeInfo, TaskCondition
```

#### 2.1.3 `src/types/region.ts`

```typescript
// RegionInfo, RegionCategory, RegionItem, InfoSource
```

#### 2.1.4 `src/types/chat.ts`

```typescript
// ChatMessage, AIIntent, AIAction
```

#### 2.1.5 `src/types/index.ts`

```typescript
// すべての型をre-export
```

**完了条件**:
- [ ] すべての型定義ファイルが作成される
- [ ] TypeScriptエラーがない
- [ ] `src/types/index.ts` からすべての型がexportされる

---

### 2.2 モックデータの作成

**タスク**: 地域情報・手続きのモックデータを作成

**参照**: @specs/requirements.md の「JPDオリジナル地域情報コンテンツ」セクション

**重要**: 各情報には**情報源（source）** を必ず含める

#### 2.2.1 `src/data/regions/setagaya.json`

世田谷区の地域情報（8カテゴリ分）

**含める情報**:
- 生活基本（ゴミ出し、町内会）
- 子育て（保育園、学校、公園）
- 医療・健康（病院、薬局）
- 買い物（スーパー、商店街）
- グルメ（飲食店、カフェ）
- 行事・イベント（お祭り）
- 防災（避難所、ハザードマップ）
- 交通（最寄り駅、バス）

**JPDオリジナルコンテンツ（現場知）の例**:

| カテゴリ | 公式情報 | 郵便局員ならではの情報（必ず含める） |
|---------|---------|----------------------------------|
| ゴミ出し | 曜日・分別ルール | 「池尻の集積所は朝7時までに出さないと回収されない」 |
| 買い物 | 店舗一覧 | 「三軒茶屋のスーパー〇〇は火曜が特売日」 |
| 医療 | 病院リスト | 「□□クリニックは予約なしでも待ち時間が短い」 |
| 子育て | 保育園リスト | 「世田谷公園は午前中ママさんが集まる」 |
| 防災 | 避難所一覧 | 「目黒川沿いは大雨で浸水しやすいので注意」 |

**情報源タイプ（source.type）**:
- `postal_worker`: 📮 配達員からの情報
- `community`: 👥 地元の方からの情報
- `official`: 🏛️ 公式情報

#### 2.2.2 `src/data/regions/yokohama.json`

横浜市（青葉区）の地域情報
※ 同様にJPDオリジナルコンテンツを含める

#### 2.2.3 `src/data/regions/fukuoka.json`

福岡市（中央区）の地域情報
※ 同様にJPDオリジナルコンテンツを含める

#### 2.2.4 `src/data/procedures.json`

手続きマスタデータ（12件程度）

**含める手続き**:
| カテゴリ | 手続き | 自動化レベル |
|---------|--------|-------------|
| 行政 | 転入届 | Lv.1 |
| 行政 | マイナンバーカード住所変更 | Lv.2 |
| 行政 | 国民健康保険 | Lv.1 |
| ライフライン | 電気 | Lv.3 |
| ライフライン | ガス | Lv.3 |
| ライフライン | 水道 | Lv.3 |
| ライフライン | インターネット | Lv.3 |
| 金融 | 銀行口座 | Lv.1 |
| 金融 | クレジットカード | Lv.1 |
| その他 | 運転免許証 | Lv.1 |
| その他 | 郵便転送届 | Lv.4 |
| 子育て | 保育園・幼稚園 | Lv.1 |

#### 2.2.5 `src/data/postal-codes.json`

郵便番号→住所変換データ（対応地域のみ）

**完了条件**:
- [ ] すべてのモックデータファイルが作成される
- [ ] JSONとして正しくパースできる
- [ ] 型定義と整合している
- [ ] 各情報に情報源（source）が含まれている
- [ ] 郵便局員ならではの「現場知」情報が各カテゴリに含まれている

---

### 2.3 Context の作成

**タスク**: 状態管理用のContextを作成

**参照**: @specs/design.md の状態管理

#### 2.3.1 `src/contexts/UserContext.tsx`

- UserProfileの管理
- localStorage との同期
- オンボーディング状態の管理

#### 2.3.2 `src/contexts/TaskContext.tsx`

- タスク一覧の管理
- ステータス更新
- タスク自動生成ロジック
- 次のアクション取得

#### 2.3.3 `src/contexts/ChatContext.tsx`

- チャット履歴の管理
- メッセージ追加
- 履歴クリア

**完了条件**:
- [ ] すべてのContextが作成される
- [ ] Provider でアプリをラップできる
- [ ] useContext で値が取得できる

**依存**: 2.1, 2.2

---

### 2.4 localStorage フック

**タスク**: `src/hooks/useLocalStorage.ts` を作成

```typescript
function useLocalStorage<T>(key: string, initialValue: T): [T, (value: T) => void]
```

**完了条件**:
- [ ] フックが作成される
- [ ] 値の読み書きができる
- [ ] リロード後も値が保持される

---

### 2.5 Phase 2 コミット

```bash
git add .
git commit -m "feat: 型定義とモックデータを作成"
```

---

## Phase 3: AIチャット基盤

### 3.1 AIプロンプト定義

**タスク**: `src/lib/ai/prompts.ts` を作成

**参照**: @specs/design.md のAIエージェント設計

**含める内容**:
- システムプロンプト（SYSTEM_PROMPT）
- オンボーディング用プロンプト
- アシスタント用プロンプト
- 質問応答用プロンプト

**完了条件**:
- [ ] プロンプトファイルが作成される
- [ ] 各シーン用のプロンプトが定義される

---

### 3.2 モックレスポンス

**タスク**: `src/lib/ai/mock-responses.ts` を作成

APIキーなしでも動作するモックレスポンスを定義

**含めるシナリオ**:
- オンボーディング会話フロー
- 質問への定型回答
- タスク完了時の応答

**完了条件**:
- [ ] モックレスポンスが作成される
- [ ] オンボーディングの会話フローが再現できる

---

### 3.3 チャットAPIルート

**タスク**: `src/app/api/chat/route.ts` を作成

```typescript
// POST /api/chat
// - OpenAI API を使用（APIキーがある場合）
// - モックレスポンスを使用（APIキーがない場合）
```

**完了条件**:
- [ ] APIルートが作成される
- [ ] POSTリクエストでレスポンスが返る
- [ ] APIキーなしでもモックで動作する

**依存**: 3.1, 3.2

---

### 3.4 チャットUIコンポーネント

**タスク**: チャット関連コンポーネントを作成

#### 3.4.1 `src/components/chat/ChatMessage.tsx`

- ユーザー/アシスタントのメッセージ表示
- アバター、タイムスタンプ
- マークダウン対応（簡易）

#### 3.4.2 `src/components/chat/ChatInput.tsx`

- テキスト入力フォーム
- 送信ボタン
- ローディング状態

#### 3.4.3 `src/components/chat/QuickActions.tsx`

- クイックアクションボタン
- 定型文の送信

#### 3.4.4 `src/components/chat/ChatContainer.tsx`

- チャット全体のコンテナ
- メッセージ一覧の表示
- スクロール制御
- useChat フックとの連携

**完了条件**:
- [ ] すべてのコンポーネントが作成される
- [ ] チャットの送受信ができる
- [ ] ローディング状態が表示される

**依存**: 3.3

---

### 3.5 チャットフック

**タスク**: `src/hooks/useChat.ts` を作成

Vercel AI SDK の useChat をラップし、追加機能を実装

**機能**:
- メッセージ送信
- ストリーミング受信
- オンボーディング状態管理
- 収集データの構造化

**完了条件**:
- [ ] フックが作成される
- [ ] メッセージの送受信ができる

**依存**: 3.3

---

### 3.6 トップページ実装

**タスク**: `src/app/page.tsx` を実装

- チャットUIを表示
- オンボーディング/アシスタントモードの切り替え
- オンボーディング完了時にダッシュボードへ遷移

**参照**:
- @specs/requirements.md US-0
- @specs/design.md チャット画面レイアウト

**完了条件**:
- [ ] トップページでチャットが動作する
- [ ] AIとの会話ができる
- [ ] オンボーディングフローが動作する

**依存**: 3.4, 3.5

---

### 3.7 Phase 3 コミット

```bash
git add .
git commit -m "feat: AIチャット機能を実装"
```

---

## Phase 4: コア機能実装

### 4.1 タスク自動生成ロジック

**タスク**: `src/lib/tasks/generator.ts` を作成

**機能**:
- UserProfile からタスクリストを生成
- 家族構成に応じたタスクの追加/除外
- 転入日からの期限計算

**参照**: @specs/requirements.md US-2

**完了条件**:
- [ ] タスク生成ロジックが実装される
- [ ] 家族構成によってタスクが変わる
- [ ] 期限が正しく計算される

**依存**: 2.1, 2.2

---

### 4.2 優先度計算ロジック

**タスク**: `src/lib/tasks/prioritizer.ts` を作成

**機能**:
- 期限ベースの優先度計算
- 依存関係の考慮
- 次のおすすめアクションの決定

**完了条件**:
- [ ] 優先度計算ロジックが実装される
- [ ] 期限が近いタスクが高優先度になる

**依存**: 4.1

---

### 4.3 ダッシュボードコンポーネント

**タスク**: ダッシュボード関連コンポーネントを作成

#### 4.3.1 `src/components/dashboard/ProgressSummary.tsx`

- 完了数/全体数の表示
- プログレスバー
- 完了率の表示

#### 4.3.2 `src/components/dashboard/NextAction.tsx`

- 次のおすすめアクションの表示
- 期限の強調表示
- ワンクリック完了ボタン

#### 4.3.3 `src/components/dashboard/TaskList.tsx`

- タスク一覧の表示
- カテゴリ別フィルター
- ステータス別フィルター

**参照**:
- @specs/requirements.md US-6, US-8
- @specs/design.md ダッシュボードレイアウト

**完了条件**:
- [ ] すべてのコンポーネントが作成される
- [ ] 進捗状況が表示される
- [ ] 次のアクションが表示される

**依存**: 4.1, 4.2

---

### 4.4 ダッシュボードページ

**タスク**: `src/app/dashboard/page.tsx` を実装

- ProgressSummary, NextAction, TaskList を配置
- AIアシスタントとの連携（チャットウィジェット）

**完了条件**:
- [ ] ダッシュボードページが表示される
- [ ] タスクの進捗が確認できる
- [ ] タスクを完了にできる

**依存**: 4.3

---

### 4.5 タスク詳細コンポーネント

**タスク**: タスク詳細関連コンポーネントを作成

#### 4.5.1 `src/components/tasks/TaskCard.tsx`

- タスクカードの表示
- 自動化レベルバッジ
- 完了チェックボックス

#### 4.5.2 `src/components/tasks/TaskDetail.tsx`

- 必要書類一覧
- 窓口情報
- オンライン申請リンク

#### 4.5.3 `src/components/tasks/AutomationLevel.tsx`

- 自動化レベルの視覚的表示
- レベル説明のツールチップ

**参照**: @specs/requirements.md US-5

**完了条件**:
- [ ] すべてのコンポーネントが作成される
- [ ] 手続きの詳細が表示される

**依存**: 4.1

---

### 4.6 タスク一覧・詳細ページ

**タスク**: タスク関連ページを実装

#### 4.6.1 `src/app/tasks/page.tsx`

- やることリスト一覧

#### 4.6.2 `src/app/tasks/[id]/page.tsx`

- タスク詳細ページ

**完了条件**:
- [ ] タスク一覧ページが表示される
- [ ] タスク詳細ページが表示される
- [ ] タスクを完了にできる

**依存**: 4.5

---

### 4.7 地域ガイドコンポーネント

**タスク**: 地域ガイド関連コンポーネントを作成

#### 4.7.1 `src/components/guide/CategoryCard.tsx`

- カテゴリカードの表示
- アイコン、説明

#### 4.7.2 `src/components/guide/InfoItem.tsx`

- 情報アイテムの表示
- タグ、詳細

#### 4.7.3 `src/components/guide/SourceBadge.tsx`

- 情報源バッジ
- 「郵便局員からの情報」等

**参照**: @specs/requirements.md US-3, US-7

**完了条件**:
- [ ] すべてのコンポーネントが作成される
- [ ] 情報源が明示される

---

### 4.8 地域ガイドページ

**タスク**: 地域ガイド関連ページを実装

#### 4.8.1 `src/app/guide/page.tsx`

- カテゴリ一覧

#### 4.8.2 `src/app/guide/[category]/page.tsx`

- カテゴリ詳細

**完了条件**:
- [ ] 地域情報が表示される
- [ ] カテゴリ別に閲覧できる
- [ ] 情報源が明示される

**依存**: 4.7

---

### 4.9 共通レイアウト・ナビゲーション

**タスク**: 共通UIを実装

#### 4.9.1 `src/app/layout.tsx`

- Provider のラップ
- 共通ヘッダー

#### 4.9.2 ヘッダーコンポーネント

- ロゴ
- ナビゲーション（ダッシュボード、やること、地域ガイド）
- ユーザー情報

#### 4.9.3 ボトムナビゲーション（モバイル）

- モバイル用のタブナビゲーション

**完了条件**:
- [ ] 共通レイアウトが適用される
- [ ] ページ間の遷移ができる

---

### 4.10 Phase 4 コミット

```bash
git add .
git commit -m "feat: コア機能（ダッシュボード、タスク、地域ガイド）を実装"
```

---

## Phase 5: UI/UX改善

### 5.1 UIコンポーネントの整備

**タスク**: 共通UIコンポーネントを作成

#### 5.1.1 `src/components/ui/Button.tsx`

- プライマリ/セカンダリ/ゴースト
- サイズバリエーション
- ローディング状態

#### 5.1.2 `src/components/ui/Card.tsx`

- カードコンテナ
- ヘッダー/ボディ/フッター

#### 5.1.3 `src/components/ui/Input.tsx`

- テキスト入力
- エラー状態

#### 5.1.4 `src/components/ui/Badge.tsx`

- ステータスバッジ
- カラーバリエーション

**完了条件**:
- [ ] すべてのUIコンポーネントが作成される
- [ ] 既存コンポーネントに適用される

---

### 5.2 レスポンシブ対応

**タスク**: モバイル・タブレット対応

- ブレークポイントの調整
- モバイル用レイアウト
- タッチ操作の最適化

**参照**: @specs/design.md レスポンシブブレークポイント

**完了条件**:
- [ ] スマートフォンで正常に表示される
- [ ] タブレットで正常に表示される
- [ ] PCで正常に表示される

---

### 5.3 パーソナライズ機能

**タスク**: 家族構成・関心事によるパーソナライズを実装

- 優先表示の実装
- 「あなたへのおすすめ」セクション

**参照**: @specs/requirements.md US-4

**完了条件**:
- [ ] 家族構成によって情報の優先順位が変わる
- [ ] おすすめセクションが表示される

**依存**: 2.3

---

### 5.4 アニメーション・トランジション

**タスク**: UX向上のためのアニメーション追加

- ページ遷移
- カードのホバー
- チェックボックスの完了アニメーション

**完了条件**:
- [ ] 主要なインタラクションにアニメーションが適用される

---

### 5.5 Phase 5 コミット

```bash
git add .
git commit -m "style: UI/UX改善とレスポンシブ対応"
```

---

## Phase 6: テスト・デプロイ

### 6.1 動作確認

**タスク**: 全機能の動作確認

**確認項目**:

#### オンボーディング
- [ ] チャットで情報入力ができる
- [ ] 郵便番号から住所が補完される
- [ ] 家族構成を入力できる
- [ ] 確認画面が表示される
- [ ] タスクが自動生成される

#### ダッシュボード
- [ ] 進捗状況が表示される
- [ ] 次のおすすめアクションが表示される
- [ ] タスクを完了にできる
- [ ] AIに質問できる

#### 地域ガイド
- [ ] 地域情報が表示される
- [ ] カテゴリ別に閲覧できる
- [ ] 情報源が明示される

#### 全体
- [ ] ページ遷移ができる
- [ ] データがリロード後も保持される
- [ ] モバイルで正常に動作する

---

### 6.2 ビルド確認

**タスク**: 本番ビルドの確認

```bash
npm run build
npm run start
```

**完了条件**:
- [ ] ビルドエラーがない
- [ ] 本番モードで正常に動作する

---

### 6.3 Vercelデプロイ

**タスク**: Vercelにデプロイ

1. GitHubリポジトリを作成
2. Vercelと連携
3. 環境変数を設定（OPENAI_API_KEY）
4. デプロイ実行

```bash
git remote add origin <repository-url>
git push -u origin main
```

**完了条件**:
- [ ] Vercelにデプロイされる
- [ ] 公開URLでアクセスできる
- [ ] 本番環境で正常に動作する

---

### 6.4 最終コミット

```bash
git add .
git commit -m "chore: デプロイ準備完了"
git push
```

---

## ✅ 全体の完了条件

### 機能要件（requirements.md より）

#### P0（必須）
- [ ] US-0: AIアシスタントによる情報収集
- [ ] US-1: 基本情報入力
- [ ] US-2: やることリスト自動生成
- [ ] US-3: 地域ガイド表示
- [ ] US-8: AIによるプロアクティブ支援

#### P1（重要）
- [ ] US-4: パーソナライズ表示
- [ ] US-5: 手続き詳細表示
- [ ] US-6: 進捗管理ダッシュボード
- [ ] US-7: 地域情報詳細
- [ ] US-9: AIによる質問応答

### 成功指標

- [ ] 会話形式で情報入力が完了できる
- [ ] AIが次のアクションを提案してくれる
- [ ] 地域情報に情報源が明示されている
- [ ] モバイル・PCで正常に動作する
- [ ] Vercelにデプロイされている

---

## 📝 実装時の指示例

各タスクを実装する際は、以下のように指示してください:

```
「@specs/tasks.md の Phase 2.1 に沿って、型定義を作成してください」

「@specs/tasks.md の Phase 3.4 に沿って、チャットUIコンポーネントを作成してください」

「@specs/tasks.md の Phase 4.3 に沿って、ダッシュボードコンポーネントを作成してください」
```

---

**作成日**: 2026-01-19
**参照**:
- specs/requirements.md
- specs/design.md
